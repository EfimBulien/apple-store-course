@using TechStoreEll.Core.Entities
@model TechStoreEll.Core.Models.CheckoutModel

@{
    ViewData["Title"] = "Оформление заказа";
}

<h2>Оформление заказа</h2>

<form asp-action="CreateOrder" method="post">
    @Html.AntiForgeryToken()

    <h4>Адрес доставки</h4>
    <select asp-for="ShippingAddressId" class="form-control mb-3" required>
        <option value="">Выберите адрес</option>
        @foreach (var addr in (ViewBag.Addresses as List<Address>)!)
        {
            <option value="@addr.Id">@addr.City, @addr.Street @addr.House @(addr.Apartment != null 
                ? $"кв. {addr.Apartment}" : "")</option>
        }
    </select>

    <div class="form-check mb-3">
        <input asp-for="UseSameAddress" class="form-check-input" type="checkbox" id="useSame" />
        <label class="form-check-label" for="useSame">Использовать тот же адрес для оплаты</label>
    </div>

    <div id="billing-section" style="display:@(Model.UseSameAddress ? "none" : "block")">
        <h4>Платёжный адрес</h4>
        <select asp-for="BillingAddressId" class="form-control mb-3">
            <option value="">Выберите адрес</option>
            @foreach (var addr in (ViewBag.Addresses as List<Address>)!)
            {
                <option value="@addr.Id">@addr.City, @addr.Street @addr.House @(addr.Apartment != null 
                    ? $"кв. {addr.Apartment}" : "")</option>
            }
        </select>
    </div>

    <button type="submit" class="btn btn-success">Оформить заказ</button>
    <a asp-controller="Cart" asp-action="Index" class="btn btn-secondary">Назад в корзину</a>
</form>

@section Scripts {
    <script>
        document.getElementById('useSame').addEventListener('change', function () {
            document.getElementById('billing-section').style.display = this.checked ? 'none' : 'block';
        });
    </script>
}